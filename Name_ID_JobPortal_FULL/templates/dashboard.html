
{% extends "base.html" %}
{% block content %}
<h1 class="text-3xl font-bold mb-6">Dashboard</h1>

{% if user.is_authenticated %}
  {% if user.user_type == 'JOBSEEKER' %}
    <div class="mb-8 bg-blue-50 border border-blue-200 p-6 rounded flex justify-between items-center">
      <div>
        <h2 class="text-2xl font-bold mb-2">Welcome, {{ user.first_name|default:user.username }}</h2>
        <p class="text-gray-600">Your skills: <span class="font-semibold">{{ user.jobseekerprofile.skills|default:"(Not set)" }}</span></p>
      </div>
      <a href="/accounts/profile/" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 font-medium">Update Profile</a>
    </div>

    <!-- Applications Count Card -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
      <div class="bg-gradient-to-br from-blue-500 to-blue-600 text-white p-6 rounded shadow">
        <h3 class="text-lg font-semibold mb-2">Total Applications</h3>
        <p class="text-4xl font-bold">{{ applications|length }}</p>
        <p class="text-blue-100 text-sm mt-2">Jobs you applied for</p>
      </div>
      <div class="bg-gradient-to-br from-purple-500 to-purple-600 text-white p-6 rounded shadow">
        <h3 class="text-lg font-semibold mb-2">Skills</h3>
        <p class="text-2xl font-bold truncate">{{ user.jobseekerprofile.skills|default:"—" }}</p>
        <p class="text-purple-100 text-sm mt-2">Your expertise</p>
      </div>
    </div>

    <!-- Applied Jobs Table for Jobseekers -->
    {% if applications %}
      <div class="mt-12">
        <h3 class="text-2xl font-bold mb-6">My Applications</h3>
        <div class="overflow-x-auto bg-white rounded shadow">
          <table class="w-full">
            <thead class="bg-gray-100 border-b">
              <tr>
                <th class="text-left px-6 py-4 font-semibold">Job Title</th>
                <th class="text-left px-6 py-4 font-semibold">Company</th>
                <th class="text-left px-6 py-4 font-semibold">Openings</th>
                <th class="text-left px-6 py-4 font-semibold">Applied On</th>
                <th class="text-center px-6 py-4 font-semibold">Action</th>
              </tr>
            </thead>
            <tbody>
              {% for application in applications %}
                <tr class="border-b hover:bg-gray-50">
                  <td class="px-6 py-4 font-medium">{{ application.job.title }}</td>
                  <td class="px-6 py-4">
                    <div class="flex items-center gap-3">
                      {% if application.job.company_logo %}
                        <img src="{{ application.job.company_logo.url }}" alt="Logo" class="h-8 w-8 object-cover rounded">
                      {% endif %}
                      {{ application.job.recruiter.recruiterprofile.company_name|default:"Company" }}
                    </div>
                  </td>
                  <td class="px-6 py-4">{{ application.job.openings }}</td>
                  <td class="px-6 py-4 text-sm">{{ application.applied_on|date:"M d, Y" }}</td>
                  <td class="px-6 py-4 text-center">
                    <a href="{% url 'job_detail' application.job.id %}" class="text-blue-600 hover:text-blue-800 font-medium text-sm">View Job</a>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    {% endif %}

  {% elif user.user_type == 'RECRUITER' %}
    <div class="mb-8 bg-green-50 border border-green-200 p-6 rounded flex justify-between items-center">
      <div>
        <h2 class="text-2xl font-bold mb-2">Your Company: {{ user.recruiterprofile.company_name|default:"Not set" }}</h2>
        <p class="text-gray-600">Manage your job postings</p>
      </div>
      <a href="{% url 'job_create' %}" class="bg-green-600 text-white px-6 py-3 rounded hover:bg-green-700 font-medium">Post a New Job</a>
    </div>

    <!-- Jobs Table -->
    {% if your_jobs %}
      <div class="overflow-x-auto bg-white rounded shadow">
        <table class="w-full">
          <thead class="bg-gray-100 border-b">
            <tr>
              <th class="text-left px-6 py-4 font-semibold">Job Title</th>
              <th class="text-left px-6 py-4 font-semibold">Openings</th>
              <th class="text-left px-6 py-4 font-semibold">Skills Required</th>
              <th class="text-left px-6 py-4 font-semibold">Applications</th>
              <th class="text-center px-6 py-4 font-semibold">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for job in your_jobs %}
              <tr class="border-b hover:bg-gray-50">
                <td class="px-6 py-4">
                  <div class="flex items-center gap-3">
                    {% if job.company_logo %}
                      <img src="{{ job.company_logo.url }}" alt="Logo" class="h-8 w-8 object-cover rounded">
                    {% endif %}
                    <span class="font-medium">{{ job.title }}</span>
                  </div>
                </td>
                <td class="px-6 py-4">{{ job.openings }}</td>
                <td class="px-6 py-4 text-sm">{{ job.skills|truncatechars:30 }}</td>
                <td class="px-6 py-4 text-center font-semibold">{{ job.jobapplication_set.count }}</td>
                <td class="px-6 py-4 text-center">
                  <div class="flex gap-3 justify-center">
                    <a href="{% url 'job_edit' job.id %}" class="text-blue-600 hover:text-blue-800 text-sm font-medium">Edit</a>
                    <a href="{% url 'job_delete' job.id %}" class="text-red-600 hover:text-red-800 text-sm font-medium">Delete</a>
                  </div>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="bg-gray-50 border border-gray-200 p-8 rounded text-center">
        <p class="text-gray-600 mb-4">You haven't posted any jobs yet.</p>
        <a href="{% url 'job_create' %}" class="inline-block bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 font-medium">Create your first job posting →</a>
      </div>
    {% endif %}

  {% endif %}
{% else %}
  <div class="bg-blue-50 border border-blue-200 p-8 rounded text-center">
    <h2 class="text-2xl font-bold mb-3">Welcome to JobPortal</h2>
    <p class="text-gray-600 mb-6">Sign in to see personalized job recommendations or post job opportunities</p>
    <div class="flex gap-4 justify-center">
      <a href="{% url 'login' %}" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">Login</a>
      <a href="{% url 'register' %}" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">Register</a>
    </div>
  </div>
{% endif %}
{% endblock %}
